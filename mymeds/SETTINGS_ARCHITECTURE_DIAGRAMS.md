# Settings View - Architecture Diagram

## System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         MyMeds App                                   â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Home Screen (UI Layer)                                      â”‚    â”‚
â”‚  â”‚                                                              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚ AppBar                                                 â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  [âš™ï¸ Settings]  [ğŸ“Š Stats]  [ğŸ“ˆ Analytics]  [ğŸšª Logout] â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚                           â†“                                  â”‚    â”‚
â”‚  â”‚                    Scaffold.drawer                          â”‚    â”‚
â”‚  â”‚                           â†“                                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚ SettingsView (Widget Layer) - Drawer Component        â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                                                        â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ Header                                           â”‚ â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  [âš™ï¸] ConfiguraciÃ³n                             â”‚ â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ Datos Section                                   â”‚ â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â–¡ Modo Ahorro de Datos         [â”€â”€â”€ â—â—â—â”€â”€â”€â”€â”€â”€] â”‚ â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ Notificaciones Section                          â”‚ â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â–¡ Notificaciones Generales      [â”€â”€â”€ â—â—â—â”€â”€â”€â”€â”€â”€] â”‚ â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â–¡ Notificaciones Push          [â”€â”€â”€â”€â”€â”€â”€â”€â— â”€â”€â”€â”€] â”‚ â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â–¡ Notificaciones Email         [â”€â”€â”€â”€â”€â”€â”€â”€â— â”€â”€â”€â”€] â”‚ â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ Cuenta Section                                  â”‚ â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  [J] Juan PÃ©rez                                 â”‚ â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚      juan@example.com                           â”‚ â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ Ayuda Section                                   â”‚ â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  [i] Acerca de MyMeds              [>]          â”‚ â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  [ğŸ”’] PolÃ­tica de Privacidad       [>]          â”‚ â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ [X] Cerrar                                      â”‚ â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                      â†“                               â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ Consumer<SettingsProvider>(builder...)             â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                         â†“                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ SettingsProvider (State Management Layer)                   â”‚   â”‚
â”‚  â”‚ ChangeNotifier + Provider Pattern                           â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Properties:                                                 â”‚   â”‚
â”‚  â”‚  â€¢ _dataSaverModeEnabled: bool                              â”‚   â”‚
â”‚  â”‚  â€¢ _notificationsEnabled: bool                              â”‚   â”‚
â”‚  â”‚  â€¢ _pushNotificationsEnabled: bool                          â”‚   â”‚
â”‚  â”‚  â€¢ _emailNotificationsEnabled: bool                         â”‚   â”‚
â”‚  â”‚  â€¢ _isLoading: bool                                         â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Methods:                                                    â”‚   â”‚
â”‚  â”‚  â€¢ toggleDataSaverMode(bool)                                â”‚   â”‚
â”‚  â”‚  â€¢ toggleNotifications(bool)                                â”‚   â”‚
â”‚  â”‚  â€¢ togglePushNotifications(bool)                            â”‚   â”‚
â”‚  â”‚  â€¢ toggleEmailNotifications(bool)                           â”‚   â”‚
â”‚  â”‚  â€¢ resetToDefaults()                                        â”‚   â”‚
â”‚  â”‚  â€¢ notifyListeners()  â† Triggers UI rebuild               â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚         On Toggle Change:                                   â”‚   â”‚
â”‚  â”‚         1. Update local state (optimistic)                 â”‚   â”‚
â”‚  â”‚         2. notifyListeners() â†’ UI updates                 â”‚   â”‚
â”‚  â”‚         3. Call SettingsService.setXxx() (async)          â”‚   â”‚
â”‚  â”‚         4. On error: revert state                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                     â†“                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ SettingsService (Persistence Layer)                         â”‚   â”‚
â”‚  â”‚ Singleton Pattern                                            â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Properties:                                                 â”‚   â”‚
â”‚  â”‚  â€¢ _prefs: SharedPreferences instance                        â”‚   â”‚
â”‚  â”‚  â€¢ _initialized: bool                                        â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Methods:                                                    â”‚   â”‚
â”‚  â”‚  â€¢ init() â† Called in main()                                â”‚   â”‚
â”‚  â”‚  â€¢ getDataSaverMode() â†’ bool                                â”‚   â”‚
â”‚  â”‚  â€¢ setDataSaverMode(bool) â†’ Future<bool>                    â”‚   â”‚
â”‚  â”‚  â€¢ getNotificationsEnabled() â†’ bool                         â”‚   â”‚
â”‚  â”‚  â€¢ setNotificationsEnabled(bool) â†’ Future<bool>             â”‚   â”‚
â”‚  â”‚  â€¢ ... (similar for other settings)                         â”‚   â”‚
â”‚  â”‚  â€¢ clearAllSettings() â†’ Future<bool>                        â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚         Storage Key Pattern:                                â”‚   â”‚
â”‚  â”‚         'setting_name_enabled' â†’ bool value                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  SharedPreferences          â”‚
        â”‚                             â”‚
        â”‚  Device Local Storage       â”‚
        â”‚  (Persistent Across        â”‚
        â”‚   App Restarts)            â”‚
        â”‚                             â”‚
        â”‚  Keys:                      â”‚
        â”‚  â€¢ data_saver_mode_en...   â”‚
        â”‚  â€¢ notifications_enabled   â”‚
        â”‚  â€¢ push_notifications...   â”‚
        â”‚  â€¢ email_notifications...  â”‚
        â”‚                             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Diagram

### Setting a Value (Toggle)

```
User taps toggle
        â†“
SettingsView.onChanged(newValue)
        â†“
context.read<SettingsProvider>().toggle_xxx(newValue)
        â†“
        â”œâ”€â†’ [1] Update state: _xxx = newValue
        â”‚
        â”œâ”€â†’ [2] notifyListeners()
        â”‚        â†“
        â”‚   Consumer widgets rebuild with new value
        â”‚
        â”œâ”€â†’ [3] Call _settingsService.setXxx(newValue) [ASYNC]
        â”‚        â†“
        â”‚        â”œâ”€ await _prefs.setBool(key, value)
        â”‚        â”‚
        â”‚        â””â”€ if error:
        â”‚            â””â”€ Revert state: _xxx = !newValue
        â”‚            â””â”€ notifyListeners() (revert UI)
        â”‚            â””â”€ Show error (future: snackbar)
        â”‚
        â””â”€â†’ [4] Return to user (state updated, persistence happening)
```

### Getting a Value (Read)

```
context.watch<SettingsProvider>().dataSaverModeEnabled
        â†“
SettingsProvider getter returns _dataSaverModeEnabled
        â†“
Widget rebuilds whenever this value changes
        â†“
        â””â”€â†’ More efficient than reading from disk each time
```

### App Startup Flow

```
main() called
    â†“
WidgetsFlutterBinding.ensureInitialized()
    â†“
Firebase.initializeApp()
    â†“
UserSession().init()
    â†“
SettingsService().init()  â† Load from SharedPreferences
    â”‚
    â””â”€â†’ _prefs = await SharedPreferences.getInstance()
    â”‚   Loads all stored values into memory
    â”‚   Future calls will be instant (no disk access)
    â”‚
    â†“
MultiProvider([
    SettingsProvider() â† Initializes with values from storage
])
    â”‚
    â””â”€â†’ settingsProvider.init()  â† Load from SettingsService
        â”‚
        â””â”€â†’ _dataSaverModeEnabled = _settingsService.getDataSaverMode()
            (etc for other settings)
    â”‚
    â†“
App is ready, all settings loaded and available
```

---

## State Management Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        SETTINGS PROVIDER STATE MACHINE               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Loading    â”‚  â† Initial state or reset
    â”‚   _isLoading=true
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ init() or resetToDefaults() completes
             â”‚
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Ready/Idle     â”‚  â† Normal state
    â”‚   _isLoading=false
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ User toggles setting
             â”‚
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   State Updated  â”‚  â† Optimistic update
    â”‚   notifyListeners()
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Persisting to storage...
             â”‚
             â”œâ”€ Success â”€â”€â†’ Stay Updated
             â”‚
             â””â”€ Error â”€â”€â”€â”€â†’ Revert State
                           notifyListeners()
                           (UI shows original value)
```

---

## Dependency Injection Diagram

```
main()
  â”‚
  â”œâ”€â†’ SettingsService (Singleton)
  â”‚   â””â”€â†’ Manages SharedPreferences instance
  â”‚
  â””â”€â†’ MultiProvider
      â”‚
      â””â”€â†’ SettingsProvider (ChangeNotifier)
          â”‚
          â”œâ”€â†’ Uses SettingsService for persistence
          â”‚
          â””â”€â†’ Available throughout app:
              â”œâ”€ context.read<SettingsProvider>()  [One-time access]
              â”œâ”€ context.watch<SettingsProvider>() [Reactive watching]
              â””â”€ Consumer<SettingsProvider>()      [Scoped watching]
```

---

## Component Interaction Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       HOME SCREEN                               â”‚
â”‚                                                                  â”‚
â”‚  AppBar                                                          â”‚
â”‚  â”œâ”€ Leading: IconButton                                         â”‚
â”‚  â”‚   â””â”€ onPressed â†’ Scaffold.of(context).openDrawer()         â”‚
â”‚  â”‚                                                               â”‚
â”‚  â””â”€ Title: "HOME"                                               â”‚
â”‚     Actions: [Stats] [Analytics] [Logout]                       â”‚
â”‚                                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Scaffold                                                        â”‚
â”‚  â”œâ”€ drawer: SettingsView()                                      â”‚
â”‚  â”‚  â””â”€ Consumer<SettingsProvider>                              â”‚
â”‚  â”‚     â”œâ”€ Renders toggle switches                              â”‚
â”‚  â”‚     â”œâ”€ onChanged callbacks                                  â”‚
â”‚  â”‚     â””â”€ Receives state updates                               â”‚
â”‚  â”‚                                                               â”‚
â”‚  â””â”€ body: TabBarView                                            â”‚
â”‚     â”œâ”€ HomeTab                                                  â”‚
â”‚     â”‚  â””â”€ Can use context.read/watch<SettingsProvider>        â”‚
â”‚     â”‚                                                            â”‚
â”‚     â””â”€ PrescriptionsTab                                         â”‚
â”‚        â””â”€ Can use context.read/watch<SettingsProvider>        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                          â†•ï¸ EVENTS

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  SETTINGS PROVIDER                              â”‚
â”‚                (ChangeNotifier)                                â”‚
â”‚                                                                  â”‚
â”‚  State:                                                          â”‚
â”‚  â€¢ _dataSaverModeEnabled                                        â”‚
â”‚  â€¢ _notificationsEnabled                                        â”‚
â”‚  â€¢ _pushNotificationsEnabled                                    â”‚
â”‚  â€¢ _emailNotificationsEnabled                                   â”‚
â”‚                                                                  â”‚
â”‚  Methods: toggle*(value) â†’ async update + notify              â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                          â†•ï¸ PERSIST

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SETTINGS SERVICE                             â”‚
â”‚                (Singleton)                                     â”‚
â”‚                                                                  â”‚
â”‚  Methods: set*(value) â†’ async SharedPreferences.setBool()      â”‚
â”‚           get*(void) â†’ sync return cached value               â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                          â†•ï¸ STORAGE

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            SHAREDPREFERENCES (Device Storage)                   â”‚
â”‚                                                                  â”‚
â”‚  data_saver_mode_enabled: true/false                            â”‚
â”‚  notifications_enabled: true/false                              â”‚
â”‚  push_notifications_enabled: true/false                         â”‚
â”‚  email_notifications_enabled: true/false                        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Lifecycle Sequence Diagram

```
Time   App         SettingsService  SettingsProvider  SettingsView   SharedPrefs
 â”‚      â”‚               â”‚                  â”‚               â”‚               â”‚
 â”‚      â”œâ”€â†’ init()      â”‚                  â”‚               â”‚               â”‚
 â”‚      â”‚     â”‚         â”‚                  â”‚               â”‚               â”‚
 â”‚      â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ init()           â”‚               â”‚               â”‚
 â”‚      â”‚     â”‚         â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚
 â”‚      â”‚     â”‚         â”‚    â”‚ getInstance()              â”‚               â”‚ â”‚
 â”‚      â”‚     â”‚         â”‚    â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
 â”‚      â”‚     â”‚         â”‚    â”‚                            â”‚               â”‚
 â”‚      â”‚     â”‚         â”‚    _initialized=true          â”‚               â”‚
 â”‚      â”‚     â”‚         â”‚â†â”€â”€â”€â”€â”¤                           â”‚               â”‚
 â”‚      â”‚     â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚                           â”‚               â”‚
 â”‚      â”‚     â”‚         â”‚     â”‚                           â”‚               â”‚
 â”‚      â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ init()                   â”‚               â”‚
 â”‚      â”‚     â”‚         â”‚     â”‚    â”œâ”€â”€SettingsServiceâ”€â”€â”€â”€â†’ getData()     â”‚
 â”‚      â”‚     â”‚         â”‚     â”‚    â”‚â†â”€ (all values)      â”‚               â”‚
 â”‚      â”‚     â”‚         â”‚     â”‚    â”‚                      â”‚               â”‚
 â”‚      â”‚     â”‚         â”‚     notifyListeners()          â”‚               â”‚
 â”‚      â”‚     â”‚         â”‚     â”‚    â””â”€â†’ rebuild          â”‚               â”‚
 â”‚      â”‚     â”‚         â”‚     â”‚         â”‚                â”‚               â”‚
 â”‚      â”‚     â”‚         â”‚     â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ build()      â”‚
 â”‚      â”‚     â”‚         â”‚     â”‚         â”‚                â”‚   (show      â”‚
 â”‚      â”‚     â”‚         â”‚     â”‚         â”‚                â”‚    toggles)  â”‚
 â”‚      â”‚     â”‚         â”‚     â”‚         â”‚                â”‚               â”‚
 â”‚      â”œâ”€ App Running â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚      â”‚     â”‚         â”‚     â”‚        â”‚                â”‚               â”‚
 â”‚ [User toggles Data Saver Mode]                        â”‚               â”‚
 â”‚      â”‚     â”‚         â”‚     â”‚        â”‚ onChanged(true) â”‚               â”‚
 â”‚      â”‚     â”‚         â”‚     toggleâ†â”€â”€â”¤â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚
 â”‚      â”‚     â”‚         â”‚     â”‚ D.S.(true)              â”‚               â”‚
 â”‚      â”‚     â”‚         â”‚     â”‚ notifyListeners()       â”‚               â”‚
 â”‚      â”‚     â”‚         â”‚     â”‚    â””â”€â”€â†’ rebuild         â”‚               â”‚
 â”‚      â”‚     â”‚         â”‚     â”‚         â”‚                â”‚               â”‚
 â”‚      â”‚     â”‚         â”‚     â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ build()      â”‚
 â”‚      â”‚     â”‚         â”‚     â”‚                          â”‚  (toggle ON) â”‚
 â”‚      â”‚     â”‚         â”‚     â”‚                          â”‚               â”‚
 â”‚      â”‚     â”‚         â”‚     â”œâ”€â”€setDataSaverMode(true)â”€â†’â”‚               â”‚
 â”‚      â”‚     â”‚         â”‚     â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
 â”‚      â”‚     â”‚         â”‚     â”‚         â”‚ setBool()     â”‚               â”‚ â”‚
 â”‚      â”‚     â”‚         â”‚     â”‚         â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚      â”‚     â”‚         â”‚     â”‚         â”‚ (success)     â”‚               â”‚
 â”‚      â”‚     â”‚         â”‚     â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚               â”‚
 â”‚      â”‚     â”‚         â”‚ (Complete)   â”‚               â”‚               â”‚
 â†“      â†“     â†“         â†“     â†“        â†“               â†“               â†“

Legend:
 â†’ = method call / data flow
 â† = return / callback
 â”œ = branching point
 â”” = start of new path
```

---

## File Dependencies Graph

```
main.dart
  â”œâ”€â†’ SettingsService (init before app)
  â”‚    â””â”€â†’ SharedPreferences
  â”‚
  â”œâ”€â†’ SettingsProvider (in MultiProvider)
  â”‚    â””â”€â†’ SettingsService (dependency)
  â”‚
  â””â”€â†’ MyMedsApp
      â””â”€â†’ AppRouter.generateRoute()
          â””â”€â†’ HomeScreen
              â”œâ”€â†’ SettingsView (as drawer)
              â”‚    â””â”€â†’ SettingsProvider (via context)
              â”‚         â””â”€â†’ SettingsService
              â”‚
              â”œâ”€â†’ MotionProvider (existing)
              â”œâ”€â†’ UserSession (existing)
              â””â”€â†’ AppTheme (existing)

Other screens can also:
  â””â”€â†’ context.read/watch<SettingsProvider>()
      to access settings anywhere
```

---

## Settings Toggle Dependency Graph

```
Notifications (General)
â”œâ”€â”€ Enable/Disable All Notifications
â”‚
â””â”€â†’ When ENABLED:
    â”œâ”€â†’ Push Notifications (becomes editable)
    â””â”€â†’ Email Notifications (becomes editable)

When DISABLED:
    â”œâ”€â†’ Push Notifications (disabled, greyed out)
    â””â”€â†’ Email Notifications (disabled, greyed out)

Data Saver Mode
â”œâ”€â”€ Independent toggle
â””â”€â†’ Can be enabled/disabled regardless of other settings
```

This architecture ensures scalability, maintainability, and follows Flutter best practices!
